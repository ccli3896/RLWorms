3+4
a = 4
a <- 4
a <- 5
a=6
?crossing
library(reticulate)
library(tidyverse)
library(pacman)
pacman::p_load(devtools,RcppArmadillo)
library(BART)
setwd("Research/R_RamanathanLab/RLWorms/03_24_fixImgs/")
#setwd("Research/20_09_07_NewPC/RLWorms/03_24_fixImgs/")
source("./utils.R")
# PARAMETERS
episodes = 10
# PARAMETERS
episodes = 1
start_ep = 0
num_save = 500
num_tree = 50
nskip = 200
# Fixed params
n = 12
n_dim = 2
imp_dims = 1:n_dim
error_scale = 5 # rough scale of observation error (sd for specific value)
# Start by formatting for R.
np <- import("numpy")
folder = "./Data/03_29_3/" #######################
fbase = paste(folder,"traj",sep="")
d_pred = crossing(pos = map(1:(n^length(imp_dims)), index_to_grid, n, n_dim),
which = 0:1) %>%
filter(map_lgl(pos, ~ all(.[-imp_dims] == other_locs))) %>%
unnest_wider(pos, names_sep="_")
m_pred = model.matrix(~ 0 + which + ., data=d_pred)
# Making test data
other_locs = rep(floor(n/2), n_dim - length(imp_dims))
# Making test data
other_locs = rep(floor(n/2), n_dim - length(imp_dims))
d_pred = crossing(pos = map(1:(n^length(imp_dims)), index_to_grid, n, n_dim),
which = 0:1) %>%
filter(map_lgl(pos, ~ all(.[-imp_dims] == other_locs))) %>%
unnest_wider(pos, names_sep="_")
m_pred = model.matrix(~ 0 + which + ., data=d_pred)
fname <- "combined.npy"
# Load file
d <- np$load(fname,allow_pickle=T)
d_bart <- as_tibble(matrix(unlist(d),ncol=4))
d_bart <- d_bart %>% rename(pos_1=V1, pos_2=V2, obs=V3, which=V4)
# Format for BART
bart_form = obs ~ 0 + which + .
m_bart = model.matrix(bart_form, data=d_bart)
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartcomb",ind,".npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcomb.npy",sep=""),fitx$yhat.test)
np$save(paste(folder,"bartcombsig.npy",sep=""),fitx$sigma[-c(1:nskip)])
# Load file
d <- np$load(fname,allow_pickle=T)
d_bart <- as_tibble(matrix(unlist(d),ncol=4))
d_bart <- d_bart %>% rename(pos_1=V1, pos_2=V2, obs=V3, which=V4)
# Format for BART
bart_form = obs ~ 0 + which + .
m_bart = model.matrix(bart_form, data=d_bart)
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartcomb",ind,".npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcombsig",ind,".npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
np$save(paste(folder,"bartcomb.npy",sep=""),fitx$yhat.test)
np$save(paste(folder,"bartcombsig.npy",sep=""),fitx$sigma[-c(1:nskip)])
folder
# Load file
d <- np$load(fname,allow_pickle=T)
d_bart <- as_tibble(matrix(unlist(d),ncol=4))
d_bart <- d_bart %>% rename(pos_1=V1, pos_2=V2, obs=V3, which=V4)
# Format for BART
bart_form = obs ~ 0 + which + .
m_bart = model.matrix(bart_form, data=d_bart)
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartcomb",ind,".npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcombsig",ind,".npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
np$save(paste(folder,"bartcomb.npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcombsig.npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
num_tree = 20
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartcomb.npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcombsig.npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
num_tree = 50
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartcomb.npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcombsig.npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartcomb",ind,".npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcomb.npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcombsig.npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
num_tree = 100
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartcomb.npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcombsig.npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
error_scale = 10 # rough scale of observation error (sd for specific value)
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartcomb.npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcombsig.npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
num_tree = 20
error_scale = 5 # rough scale of observation error (sd for specific value)
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=3,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartcomb",ind,".npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcomb.npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcombsig.npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
fname <- "../03_16_policyTime/Data/03_19_0/traj4.npy"
# Load file
d <- np$load(fname,allow_pickle=T)
d_bart <- as_tibble(matrix(unlist(d),ncol=4))
d_bart <- d_bart %>% rename(pos_1=V1, pos_2=V2, obs=V3, which=V4)
# Format for BART
bart_form = obs ~ 0 + which + .
m_bart = model.matrix(bart_form, data=d_bart)
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=3,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartcomb.npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcombsig.npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartcomb.npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcombsig.npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
num_tree = 200
10
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartcomb.npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcombsig.npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
error_scale = 10 # rough scale of observation error (sd for specific value)
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartcomb.npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcombsig.npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
num_tree = 200
error_scale = 10 # rough scale of observation error (sd for specific value)
fname <- "combined.npy"
# Load file
d <- np$load(fname,allow_pickle=T)
d_bart <- as_tibble(matrix(unlist(d),ncol=4))
d_bart <- d_bart %>% rename(pos_1=V1, pos_2=V2, obs=V3, which=V4)
# Format for BART
bart_form = obs ~ 0 + which + .
m_bart = model.matrix(bart_form, data=d_bart)
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartcomb.npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartcombsig.npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
num_tree = 50
error_scale = 5 # rough scale of observation error (sd for specific value)
# Start by formatting for R.
np <- import("numpy")
folder = "./Data/03_29_0/" #######################
start_ep = 9
ind <- 9
fname <- "./Data/03_29_0/traj9rot.npy"
# Making test data
other_locs = rep(floor(n/2), n_dim - length(imp_dims))
d_pred = crossing(pos = map(1:(n^length(imp_dims)), index_to_grid, n, n_dim),
which = 0:1) %>%
filter(map_lgl(pos, ~ all(.[-imp_dims] == other_locs))) %>%
unnest_wider(pos, names_sep="_")
m_pred = model.matrix(~ 0 + which + ., data=d_pred)
# Load file
d <- np$load(fname,allow_pickle=T)
d_bart <- as_tibble(matrix(unlist(d),ncol=4))
d_bart <- d_bart %>% rename(pos_1=V1, pos_2=V2, obs=V3, which=V4)
# Format for BART
bart_form = obs ~ 0 + which + .
m_bart = model.matrix(bart_form, data=d_bart)
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartrot",ind,".npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartrotsig",ind,".npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
fname <- "./Data/03_29_0/traj9.npy"
# Load file
d <- np$load(fname,allow_pickle=T)
d_bart <- as_tibble(matrix(unlist(d),ncol=4))
d_bart <- d_bart %>% rename(pos_1=V1, pos_2=V2, obs=V3, which=V4)
# Format for BART
bart_form = obs ~ 0 + which + .
m_bart = model.matrix(bart_form, data=d_bart)
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"barttest",ind,".npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"barttestsig",ind,".npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
num_tree = 20
# Load file
d <- np$load(fname,allow_pickle=T)
d_bart <- as_tibble(matrix(unlist(d),ncol=4))
d_bart <- d_bart %>% rename(pos_1=V1, pos_2=V2, obs=V3, which=V4)
# Format for BART
bart_form = obs ~ 0 + which + .
m_bart = model.matrix(bart_form, data=d_bart)
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"barttest",ind,".npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"barttestsig",ind,".npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
num_tree = 50
error_scale = 10 # rough scale of observation error (sd for specific value)
# Load file
d <- np$load(fname,allow_pickle=T)
d_bart <- as_tibble(matrix(unlist(d),ncol=4))
d_bart <- d_bart %>% rename(pos_1=V1, pos_2=V2, obs=V3, which=V4)
# Format for BART
bart_form = obs ~ 0 + which + .
m_bart = model.matrix(bart_form, data=d_bart)
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"barttest",ind,".npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"barttestsig",ind,".npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
error_scale = 5 # rough scale of observation error (sd for specific value)
# Load file
d <- np$load(fname,allow_pickle=T)
d_bart <- as_tibble(matrix(unlist(d),ncol=4))
d_bart <- d_bart %>% rename(pos_1=V1, pos_2=V2, obs=V3, which=V4)
# Format for BART
bart_form = obs ~ 0 + which + .
m_bart = model.matrix(bart_form, data=d_bart)
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"barttest",ind,".npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"barttestsig",ind,".npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"barttest",ind,".npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"barttestsig",ind,".npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"barttest",ind,".npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"barttestsig",ind,".npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"barttest",ind,".npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"barttestsig",ind,".npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
fname <- "./Data/03_29_0/traj9rot.npy"
# Load file
d <- np$load(fname,allow_pickle=T)
d_bart <- as_tibble(matrix(unlist(d),ncol=4))
d_bart <- d_bart %>% rename(pos_1=V1, pos_2=V2, obs=V3, which=V4)
# Format for BART
bart_form = obs ~ 0 + which + .
m_bart = model.matrix(bart_form, data=d_bart)
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
print(fitx$varprob.mean)
np$save(paste(folder,"bartrot",ind,".npy",sep=""),fitx$yhat.test) # nx288
np$save(paste(folder,"bartrotsig",ind,".npy",sep=""),fitx$sigma[-c(1:nskip)]) # n samples
# Making tree and saving
fitx <-  wbart(m_bart, d_bart$obs, x.test=m_pred,
base=.95,power=2,
sparse=T, a=0.5*(1+1/length(imp_dims)), nskip=nskip,
ntree=num_tree, usequants=T, ndpost=num_save, sigquant=0.9,
nkeeptrain=0)
